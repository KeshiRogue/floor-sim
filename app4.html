
<!DOCTYPE html>
<html lang="en">
<head>
<title>Supe Simulator</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>



	table {
		
	margin: 0px;
	font: inherit;
	}
	td {
		width: 30%;
		margin: 0px;
	  border-style: solid;
	  border-width: 1px;
		
		vertical-align:top;
	}
	p {
	font-family: "Lucida Console", monospace;
	text-align: right;
	padding: 10px;
	}
	h1 {
	font-family: "Lucida Console", monospace;
	text-align: center;
	padding: 0px;
	margin: 0px;
	}
	hr {
		
	padding: 0px;
	margin: 0px;
	}
	.assignButton {
		background-color: #cccee0af; 
		border: 1px;
		color: rgb(8, 8, 8);
		text-align: center;
		text-decoration: none;
		display: inline-block;
		border-radius: 8px;
	}
	.assignButtonSEL {
		background-color: #5ba5eb;
		border: 1px;
		color: white;
		text-align: center;
		text-decoration: none;
		display: inline-block;
		border-radius: 8px;
	}
	.gametable {
		
		background-color: #346fa6;
		border: 1px;
		color: white;
		text-align: center;
		text-decoration: none;
		border-radius: 8px;
		width: 160px;
		align-items: center;
		font-size: 14px;
		margin: 1px;
		white-space: pre-line;
		
	}
	.recentActions1 {
		
		background-color: #444b59;
		border: 1px;
		color: white;
		text-align: center;
		text-decoration: none;
		border-radius: 8px;
		width: 160px;
		align-items: center;
		font-size: 14px;
		margin: 1px;
		white-space: pre-line;
		
	}
	.recentActions2 {
		
		background-color: #869fa4;
		border: 1px;
		color: white;
		text-align: center;
		text-decoration: none;
		border-radius: 8px;
		width: 200px;
		align-items: center;
		font-size: 14px;
		margin: 1px;
		white-space: pre-line;
		
	}
	.techID {
		
		background-color: #79c9c1;
		border: 1px;
		color: white;
		text-align: center;
		text-decoration: none;
		border-radius: 8px;
		width: 300px;
		align-items: center;
		font-size: 14px;
		margin: 1px;
		white-space: pre-line;
		float:left;
		
	}
	.techcanvas {
		background-color: azure;
		border: 1px;
		color: rgb(0, 0, 0);
		text-align: center;
		text-decoration: none;
		border-radius: 8px;
		width: 40px;
		height: 40px;
		align-items: center;
		font-size: 14px;
		border-style:solid;
		border-width:1px;
		border-color:#000;
	}
	.gamecanvas {
		
		background-color: azure;
		border: 1px;
		color: rgb(0, 0, 0);
		text-align: center;
		text-decoration: none;
		border-radius: 8px;
		width: 140px;
		align-items: center;
		font-size: 14px;
		border-style:solid;
		border-width:1px;
		border-color:#000;
	}
	.gameP {
		font-family: "Lucida Console", monospace;
		text-align: center;
		padding: 10px;
	}
	body {
		padding: 0px;
		border: 0px;
		padding: 0px;
		margin: 8px;

	}

	canvas:hover {
		background-color: yellow;
	}
</style>


<script>


let main_loop;
let animTimer = 0;
let debugSetting = 0;
let debug_FAST_MODE = false;
let debugFlag1 = false;

let gt;
let cvs;
let ctxI;
let roleArray = [
	"Assembler",
	"Test Tech",
	"Quality Tech",
	"Trainee",
	"PCFS",
	"Lead",
	"MFE"
]

let names = [
'James',
'Michael',
'Robert',
'John',
'David',
'William',
'Richard',
'Joseph',
'Thomas',
'Christopher',
'Charles',
'Daniel',
'Matthew',
'Anthony',
'Mark',
'Donald',
'Steven',
'Andrew',
'Paul',
'Joshua',
'Kenneth',
'Kevin',
'Brian',
'Timothy',
'Ronald',
'George',
'Jason',
'Edward',
'Jeffrey',
'Ryan',
'Jacob',
'Nicholas',
'Gary',
'Eric',
'Jonathan',
'Stephen',
'Larry',
'Justin',
'Scott',
'Brandon',
'Benjamin',
'Samuel',
'Gregory',
'Alexander',
'Patrick',
'Frank',
'Raymond',
'Jack',
'Dennis',
'Jerry',
'Tyler',
'Aaron',
'Jose',
'Adam',
'Nathan',
'Henry',
'Zachary',
'Douglas',
'Peter',
'Kyle',
'Noah',
'Ethan',
'Jeremy',
'Walter',
'Keith',
'Austin',
'Roger',
'Terry',
'Sean',
'Gerald',
'Carl',
'Dylan',
'Harold',
'Jordan',
'Jesse',
'Bryan',
'Lawrence',
'Arthur',
'Gabriel',
'Bruce',
'Logan',
'Billy',
'Joe',
'Alan',
'Juan',
'Elijah',
'Willie',
'Albert',
'Wayne',
'Randy',
'Mason',
'Vincent',
'Liam',
'Roy',
'Bobby',
'Caleb',
'Bradley',
'Russell',
'Lucas',
'Mary',
'Patricia',
'Jennifer',
'Linda',
'Elizabeth',
'Barbara',
'Susan',
'Jessica',
'Karen',
'Sarah',
'Lisa',
'Nancy',
'Sandra',
'Betty',
'Ashley',
'Emily',
'Kimberly',
'Margaret',
'Donna',
'Michelle',
'Carol',
'Amanda',
'Melissa',
'Deborah',
'Stephanie',
'Rebecca',
'Sharon',
'Laura',
'Cynthia',
'Dorothy',
'Amy',
'Kathleen',
'Angela',
'Shirley',
'Emma',
'Brenda',
'Pamela',
'Nicole',
'Anna',
'Samantha',
'Katherine',
'Christine',
'Debra',
'Rachel',
'Carolyn',
'Janet',
'Maria',
'Olivia',
'Heather',
'Helen',
'Catherine',
'Diane',
'Julie',
'Victoria',
'Joyce',
'Lauren',
'Kelly',
'Christina',
'Ruth',
'Joan',
'Virginia',
'Judith',
'Evelyn',
'Hannah',
'Andrea',
'Megan',
'Cheryl',
'Jacqueline',
'Madison',
'Teresa',
'Abigail',
'Sophia',
'Martha',
'Sara',
'Gloria',
'Janice',
'Kathryn',
'Ann',
'Isabella',
'Judy',
'Charlotte',
'Julia',
'Grace',
'Amber',
'Alice',
'Jean',
'Denise',
'Frances',
'Danielle',
'Marilyn',
'Natalie',
'Beverly',
'Diana',
'Brittany',
'Theresa',
'Kayla',
'Alexis',
'Doris',
'Lori',
'Tiffany',
'Brian',
'Bryon',
'Ron',
'Cody',
"D'ondre"
]





function init () {
	gt = document.getElementById("newGUI");
	debug_console = document.getElementById("debug_console");

	company.tools.push(new Tool());
	company.bays.push(new Bay());
	company.bays.push(new Bay());
	hireTech(0);
	hireTech(0);
	hireTech(0);
	company.techs[2].role = 3;
	company.bays[0].assignTechToBay(0);
	company.bays[0].assignTechToBay(1);
	company.bays[0].assignTechToBay(2);
	
	let f="<button onclick='buyNewBay()'>Buy new bay for 5,000</button>\n<button onclick='payForRandShortage()'>Buy random Shortage for 1,000</button>\n<button onclick='hireTech(5000)'>Hire new random tech for 5,000</button>"

	document.getElementById("gui2").innerHTML = f;

	main_loop = setInterval(progressTime, 1000); //1000 is 1 sec
}



const company = {
	money:20000,
	shift:1,
	time:0,
	bays:[],
	tools:[],
	techs:[],
	backlog:[],
	recentActions:[],
	payroll:0,
	demand:0,

	adjustMoney: function(m){
		this.money = this.money - m

		if(this.money <= 0) {gameOver() }
	},
	printBays: function() {
		let s = "bays:"+this.bays.length+"<br>";

		for (var i = 0; i < this.bays.length; i++) {
			s=s+this.bays[i].print()+"<br>";
		}
		return s;
	}
}

function Bay() {
	this.assignedTool = false; //number
	this.assignedTechs = []; //number array

	this.assignTechToBay = function(tech_i) {
		const maxTechsInBay = 3;

		if(this.assignedTechs.length < maxTechsInBay) {
			this.assignedTechs.push(tech_i);
			return true;
		}
		else {
			addAct("!Can't assign another Tech on this tool!");
			return false;
		}
	}
	this.print = function() {
		let s = "";
		s=s+"Tool: " + this.assignedTool + "; Techs: ";
		for (let i = 0; i < this.assignedTechs.length; i++) {
			s=s+this.assignedTechs[i]+" ";
		}
		return s;
	}
}


function Tech() {
	this.name				 = names[Math.floor(Math.random() * names.length)];
	this.level				 = 0; //every 100 exp
	this.experiencePerc		 = 0; //added every sec
	this.assembProf			 = Math.floor(Math.random() * 3)+1;
	this.assembProfGrowth	 = Math.floor(Math.random() * 8)+1;
	this.testProf			 = Math.floor(Math.random() * 3)+1;
	this.qtProf				 = Math.floor(Math.random() * 3)+1;
	this.testProfGrowth	 = Math.floor(Math.random() * 8)+1;
	this.adminProf				 = 1;
	this.adminProfGrowth	 = Math.floor(Math.random() * 8)+1;
	this.qtProfGrowth	 = Math.floor(Math.random() * 8)+1;
	this.morale				 = 10;
	this.lastProg			 = 0;
	this.role				 = 0;
	if(chance(10)) {
		this.role	= 1;
		this.testProf += 2;
	}
	this.wage	=this.assembProf+this.testProf+this.qtProf+12;
	if(this.role==1) this.wage = this.wage + 2;

	this.reliability		 = Math.floor(Math.random() * 9);
	this.gainExp = function(ex) {
		this.experiencePerc = this.experiencePerc + ex;
		if(this.experiencePerc >= 100) this.levelUp();
	}
	this.levelUp = function() {
		this.level++;
		let s = "";
		this.experiencePerc -= 100;
		if(chance(this.assembProfGrowth*10)) {
			this.assembProf=Math.min(8, this.assembProf+1);
			s = s+ " +1 point to Assembly Prof."
		}
		if(chance(this.testProfGrowth*10)) {
			this.testProf=Math.min(8, this.testProf+1);
			s = s+ " +1 point to Test Prof."
		}
		if(chance(this.qtProfGrowth*10)) {
			this.qtProf=Math.min(8, this.qtProf+1);
			s = s+ " +1 point to QT Prof."
		}
		addAct(this.name + " leveled up!" + s);
		if(this.level % 4 == 0) this.morale--;
	}


}


/*
different Tool ideas
*/
const ToolArray = [
	[
		"Lite Saber", // easy tool
		1400, // work unit points
		50, //num of OPs
		70, //instruction eff
	],
	[
		"Scimitar", // bulk tool
		5000, // work unit points
		90, //num of OPs
		70, //instruction eff
	],
	[
		"Claymore", // difficult tool
		9600, // work unit points
		30, //num of OPs
		70, //instruction eff
	],
];



function Tool() {
	this.ben =""+ Math.floor(Math.random() * 10) +""+ Math.floor(Math.random() * 10) +""+ Math.floor(Math.random() * 10) +""+ Math.floor(Math.random() * 10) +""+ Math.floor(Math.random() * 10) +""+ Math.floor(Math.random() * 10) +""+ Math.floor(Math.random() * 10) +""+ Math.floor(Math.random() * 10) 
	this.perc = 0;
	this.shortages = Math.floor(Math.random() * 30);
	this.passedILQnum = 0;
	this.inTest = false;
	this.isComplete = false;
	this.startingShift = company.shift;
	this.print2 = function() {
		let c = "A";
		if (this.inTest) c = "T";
		let testColor = "#d71";
		let col = "#1c1";
		if (this.inTest) col = testColor;
		
		let s = "BEN: "+
		this.ben+"\nPercent: " + c + Math.floor(this.perc)+"\n"+
		drawBar(this.perc, 100, 8, "█", col, "#000") + 
		"\nShortages: "+this.shortages+
		"\nPassed ILQ: "+this.passedILQnum+
		"\n\nStarting Shift: " +this.startingShift+"";
		
		return s;
	}
	this.increasePerc = function(add) {
		
		this.perc = Math.min(this.perc + add,100);
		if (this.perc >= 100) {
			if(this.inTest) {
				if(this.shortages > 0) this.shortages--;
				else this.isComplete = true;
			}
			else {
				this.inTest = true;
				this.perc -= 100
			}
		} else if (this.perc < 0) {
			this.perc = 0;
		}

	}
}





function formatMoney(num) {
	let n = Math.floor(num/1000);
	let r = "" + n;
	let s = ""+num;
	r = r + ",<span style='font-size:90%'>" + s.slice(-3) + "</span>";
return r;
}

function drawBar(min, max, length, char, color1, color2) {
	let p = Math.min(Math.floor((min/max)*length), length);

	let r = "<span style='color:" + color1 + "'>";
	for(let i = 0; i < p; i++) {
		r = r + char;
	}
	r = r + "</span><span style='color:" + color2 + "'>";
	for(let i = p; i < length; i++) {
		r = r + char;
	}
	r = r + "</span>";

	return r;
}

function setDPI(canvas, dpi) {
    // Set up CSS size.
    canvas.style.width = canvas.style.width || canvas.width + 'px';
    canvas.style.height = canvas.style.height || canvas.height + 'px';

    // Get size information.
    var scaleFactor = dpi / 96;
    var width = parseFloat(canvas.style.width);
    var height = parseFloat(canvas.style.height);

    // Backup the canvas contents.
    var oldScale = canvas.width / width;
    var backupScale = scaleFactor / oldScale;
    var backup = canvas.cloneNode(false);
    backup.getContext('2d').drawImage(canvas, 0, 0);

    // Resize the canvas.
    var ctx = canvas.getContext('2d');
    canvas.width = Math.ceil(width * scaleFactor);
    canvas.height = Math.ceil(height * scaleFactor);

    // Redraw the canvas image and scale future draws.
    ctx.setTransform(backupScale, 0, 0, backupScale, 0, 0);
    ctx.drawImage(backup, 0, 0);
    ctx.setTransform(scaleFactor, 0, 0, scaleFactor, 0, 0);
}

function pop_i(arr, i) {
	arr.copyWithin(i,i+1,arr.length);
	arr.pop();
}

function chance(perc) {
	
	return perc > Math.floor(Math.random() * 100);
}





function hireTech(cost) {
	company.techs.push(new Tech());
	//Easter Egg
	if(chance(3)) {

		if(chance(20)) {
			let n = company.techs.length-1
			company.techs[n].assembProf=0;
			company.techs[n].testProf=0;
			company.techs[n].assembProfGrowth=9;
			company.techs[n].testProfGrowth=9;
			company.techs[n].name="Patrick Star";
		}
		else if(chance(20)) {
			let n = company.techs.length-1
			company.techs[n].assembProf=0;
			company.techs[n].testProf=8;
			company.techs[n].assembProfGrowth=0;
			company.techs[n].testProfGrowth=9;
			company.techs[n].name="Cool Ron";
		}
		else if(chance(20)) {
			let n = company.techs.length-1
			company.techs[n].assembProf=7;
			company.techs[n].testProf=7;
			company.techs[n].assembProfGrowth=1;
			company.techs[n].testProfGrowth=1;
			company.techs[n].name="Ron Shawn";
		}
		else if(chance(20)) {
			let n = company.techs.length-1
			company.techs[n].assembProf=2;
			company.techs[n].testProf=7;
			company.techs[n].assembProfGrowth=2;
			company.techs[n].testProfGrowth=6;
			company.techs[n].name="Other Sean";
		}
	}
	company.adjustMoney(cost);
}

function payForRandShortage() {
	/*
	let rand = Math.floor(Math.random() * company.tools.length)
	
	if(company.tools[rand].shortages > 0) {
		company.tools[rand].shortages--;
		company.money = company.money - 1000;
		addAct("Paid for shortage on " + company.tools[rand].ben);
	}
	redraw();*/
}

function buyNewBay() {
	company.money = company.money - 5000;
	company.bays.push([false,[]]);
	redraw();
}

function gameOver () {
	
document.getElementById("body").innerHTML = "GAME OVER";
clearInterval(main_loop);
}

function drawGUI() {
let g = "\n"+
"Money: " + formatMoney(company.money)+"\n"+
"Shift: " + company.shift+"\n"+
"Time: " + company.time+"\n"+
"Tools: " + company.tools.length + "\n"+
"Techs: " + company.techs.length + "\n"+
"Bays: " + company.bays.length + "\n" +
"Backlog: " + company.backlog.length + "\n";



document.getElementById("gui").innerHTML = g;

drawRecentActions ()
}

function drawRecentActions () {
let s = "\nRecent Actions:<hr><span style='color:#aaa'>";

	
	for(let i = company.recentActions.length-1; i > 0; i--) {
		s=s +"<div class='recentActions2'>"+ company.recentActions[i] +"</div>";
	}
	
document.getElementById("recentActions").innerHTML = s + "</span>";
}

function drawGame() {
	let g = "";

for(let i = 0; i < company.tools.length; i++) {
	g=g+"Bay "+(i+1)+"\n"+company.tools[i].print() + "\n\n";
}

	document.getElementById("game").innerHTML = g;
}

function drawNewGUI() {
	if(company.bays.length > 0) {
		let sss = "<tr>";

		for(let i = 0; i < company.bays.length; i++) {

			sss=sss+"<td class='gametable'><p class='gameP' id='bay"+ i +"'>BEN: ________</p></td>";
		}
		sss=sss+"</tr><tr>";

		for(let i = 0; i < company.bays.length; i++) {

			sss=sss+"<td class='gamecanvas'><canvas style='background-color: azure;' id='c" + i + "' width='130px' height='180' style='border:1px solid grey'></canvas></td>";
		}
		sss=sss+"</tr>";


		gt.innerHTML = sss;
		let pb;
		
		for(let i = 0; i < company.bays.length; i++) {
			
			cvs = document.getElementById("c"+i);
			ctxI = cvs.getContext("2d");
			//setDPI(cvs,96*4)

			drawINDVCanvasGUI(i);
			pb =  document.getElementById("bay"+i);
			pb.innerHTML =  company.tools[i].print2();
		}
	}
}

function drawINDVCanvasGUI(i) {
	ctxI.clearRect(0, 0, cvs.width, cvs.height);
	ctxI.fillStyle = "#000";
	if(company.bays[i][1]) {
		drawToolShape(10, 10, company.tools[company.bays[i][1]].perc, company.tools[company.bays[i][1]].inTest,ctxI);

		for(let aa = 0; aa < company.bays[i][2].length; aa++) {
			let ii = company.bays[i][2];
			drawTechShape(16+(aa*40), 150,company.techs[ii].morale,company.techs[ii].role, ctxI, company.techs[ii].lastProg,company.techs[ii].name);
		}
	}

}

function drawToolShape(x, y, perc, isInTest, ctx) {
	let x2 =  x+(perc);
	let y2 = y+50+perc;
	let gradient2 = ctx.createLinearGradient(x, y, x2,y2 );
	let s = "";

	if(isInTest) {
		gradient2.addColorStop("0", "rgb(231, 170, 84)");
		gradient2.addColorStop("0.5", "#a55");
		gradient2.addColorStop("1.0", "#534");
			
		s="In TEST";
	}else if(perc > 40 && perc < 50 || perc > 80 && perc < 90) {
		gradient2.addColorStop("0", "#afa");
		gradient2.addColorStop("0.5", "#5a5");
		gradient2.addColorStop("1.0", "#354");
		s="In ILQ";
	}else {
		gradient2.addColorStop("0", "#aaf");
		gradient2.addColorStop("0.5", "#55a");
		gradient2.addColorStop("1.0", "#345");
	}


x=x+15


	ctx.beginPath();
	ctx.fillStyle = gradient2;
	ctx.fillRect(x, y-perc+100, 80, perc);
	ctx.fillStyle = "black";
	ctx.strokeStyle = "black";
	ctx.rect(x, y, 80, 100);
	ctx.rect(x, y+50, 80, 10);
	ctx.rect(x, y+10, 80, 10);
	ctx.stroke();

	
	ctx.font = "12px Lucida Console";
		ctx.fillStyle = "white";
		ctx.fillText(s, x+20,y+90)
}

function drawTechShape(x, y, morale, role, ctx, lastPerc, name) {
	let color2 = "white";
	let color3 = "black";
	let colorNum;
	let gradient = ctx.createLinearGradient(x, y, x+2, y+3);


	if(role==2) {
		//green
		gradient.addColorStop(0, "#2d8");
		gradient.addColorStop(1, "green");
	}else if(role==3) {
		//blue
		gradient.addColorStop(0, "#4bd");
		gradient.addColorStop(1, "#00d");
	}else if(role==4) {
		//purple
		gradient.addColorStop(0, "#b3f");
		gradient.addColorStop(1, "#308");
	}else if(role==0 || role==1) {
		//white
		gradient.addColorStop(0, "#beceee");
		gradient.addColorStop(1, "#77c");
	}

	colorNum = gradient;


	


/*
	ctx.beginPath();
	ctx.fillStyle = color2;
	ctx.arc(x,y,20,0,2 * Math.PI);
	ctx.fill();*/
	
	ctx.beginPath();
	ctx.fillStyle = colorNum;
	ctx.arc(x,y,14,0,2 * Math.PI);
	ctx.fill();
	ctx.beginPath();
	ctx.fillStyle = "white";
	ctx.arc(x,y,12,-.1 * Math.PI,1.1 * Math.PI);
	ctx.fill();
	let offset = 3;
	ctx.beginPath();
	ctx.strokeStyle = color2;
	ctx.moveTo(x-offset,y-8);
	ctx.lineTo(x-offset,y-15);
	ctx.stroke();
	ctx.beginPath();
	ctx.strokeStyle = color2;
	ctx.moveTo(x+offset,y-8);
	ctx.lineTo(x+offset,y-15);
	ctx.stroke();
	let r = 20;
	let h = 8;
	let w = 12;
	let cap_y = y-3;
	ctx.beginPath();
	ctx.moveTo(x-w,cap_y );
	ctx.fillStyle = colorNum;
	ctx.arcTo(x,cap_y+h,x+w,cap_y,r);
	ctx.fill();

	//eyes
	ctx.beginPath();
	ctx.fillStyle =color3;
	ctx.arc(x-5,y+3,2,0,2 * Math.PI);
	ctx.fill();
	ctx.fillStyle = color3;
	ctx.arc(x+5,y+3,2,0,2 * Math.PI);
	ctx.fill();



	//mouth
	if(morale>=7) {
		ctx.beginPath()
		ctx.strokeStyle =color3;
		let n = .15
		ctx.arc(x,y+6,5,(0+n) * Math.PI,(1-n) * Math.PI);
		ctx.stroke();
	}else if(morale>=5) {
		ctx.beginPath()
		ctx.strokeStyle =color3;
		ctx.moveTo(x-5,y+8);
		ctx.lineTo(x+5,y+8);
		ctx.stroke();
	}else {
		ctx.beginPath()
		ctx.strokeStyle =color3;
		let n = .15
		ctx.arc(x,y+12,5,(1+n) * Math.PI,(0-n) * Math.PI);
		ctx.stroke();
	}

	


	if(role==1) {
		ctx.font = "12px Lucida Console";
		ctx.fillStyle = color3;
		ctx.fillText("TEST", x-12,y+24)
	}
	ctx.font = "10px Lucida Console";
	ctx.fillStyle = color3;
	ctx.fillText(Math.round(lastPerc*100), x-4,y-28)
	ctx.fillText(name.substring(0,5), x-12,y-18)
	
}

function toggleSpeed() {
	debugFlag1=true;
}

function progressHour() {
	if(debugFlag1) {
		if(!debug_FAST_MODE) {
			clearInterval(main_loop);
			main_loop = setInterval(progressTime, 100); 
			debug_FAST_MODE = !debug_FAST_MODE;
		} else {
			clearInterval(main_loop);
			main_loop = setInterval(progressTime, 1000);
			debug_FAST_MODE = !debug_FAST_MODE;
		}
		debugFlag1 = false;
	}
	company.time++;

	if(company.time > 11) {
		newShift()
	}
}





function completeTool(i) {
	let completionMoney = 15000;
	addAct(company.tools[i].ben + " was completed in " + (company.shift-company.tools[i].startingShift)+" shift(s). Added "+completionMoney+" to Money.")
	unassignAllTechsFromTool(i);
	pop_i(company.tools,i);
	company.money = company.money + completionMoney;
}




function progressTime() {
	
	progressHour();
	doWorkEachBay();

	for(let i = 0; i < company.tools.length; i++) {

		if(company.tools[i].isComplete) {
			completeTool(i);
		}
	}

	redraw();
}


let cheatArray = [
	"testProf",
	"qtProf",
	"assembProf"
];

function doTechWork(req_role,tool_i,techs_arr) {
	let prog = 0;


	for(let i = 0; i < techs_arr.length; i++) {
		if(req_role == -1 || company.techs[techs_arr[i]].role == req_role) {
			prog = (company.techs[techs_arr[i]][cheatArray[req_role]] / 8)
		}
	}

	prog = prog * (company.techs[i].morale / 10);
	company.tools[tool_i].increasePerc(prog);

}

function doWorkEachBay() {
	let total_prog = 0;

	for(let i = 0; i < company.bays.length; i++) {

		let tool_i = company.bays[i].assignedTool;

		if(!tool_i == false && tool_i < company.tools.length) {
			if(company.tools[tool_i].inTest) {
				//TEST
				doTechWork(1,tool_i,company.bays[i].assignedTechs);
			} else if(company.tools[tool_i].passedILQnum < 1 && company.tools[tool_i].perc > 40 || company.tools[tool_i].passedILQnum < 2 && company.tools[tool_i].perc > 80) {
				//ILQ
				if(company.techs[i].role==2) {
				doTechWork(2,tool_i,company.bays[i].assignedTechs);
					if(company.tools[tool_i].passedILQnum < 1 && company.tools[tool_i].perc > 50) {
						company.tools[tool_i].passedILQnum++;
					}else if(company.tools[tool_i].passedILQnum < 2 && company.tools[tool_i].perc > 90) {
						company.tools[tool_i].passedILQnum++;
					}
				}
			} else {
				//assembly
				doTechWork(-1,tool_i,company.bays[i].assignedTechs);
			}

			let ss = ""+prog;
			
		}
		company.techs[i].gainExp((prog * 3));
		company.techs[i].lastProg = prog;

		prog = 0;
	}


}

function OLDdoWorkEachBay() {
	let prog = 0;

	for(let i = 0; i < company.techs.length; i++) {

		let t_i = company.techs[i].assignedTo;

		if(t_i > -1 && t_i < company.tools.length) {
			if(company.tools[t_i].inTest) {
				//TEST
				if(company.techs[i].role==1) {
					prog = (company.techs[i].testProf/8)
				}
			} else if(company.tools[t_i].passedILQnum < 1 && company.tools[t_i].perc > 40 || company.tools[t_i].passedILQnum < 2 && company.tools[t_i].perc > 80) {
				//ILQ
				if(company.techs[i].role==2) {
					prog = (company.techs[i].qtProf/8)
					if(company.tools[t_i].passedILQnum < 1 && company.tools[t_i].perc > 50) {
						company.tools[t_i].passedILQnum++;
					}else if(company.tools[t_i].passedILQnum < 2 && company.tools[t_i].perc > 90) {
						company.tools[t_i].passedILQnum++;
					}
				}
			} else {
				//assembly
				prog = (company.techs[i].assembProf/8)
			}

			prog = prog * (company.techs[i].morale / 10);
			company.tools[t_i].increasePerc(prog);
			let ss = ""+prog;
			
		}
		company.techs[i].gainExp((prog * 3));
		company.techs[i].lastProg = prog;

		prog = 0;
	}


}





let debug_console;

function redraw() {
	
	debug_console.innerHTML = company.printBays();

	drawGUI();
	drawTechPanel();

	drawNewGUI();

}

function promoteQT(i) {
	company.techs[i].role = 2;
	company.techs[i].wage += 1;
	redraw();
}
function promoteTest(i) {
	company.techs[i].role = 1;
	company.techs[i].wage += 1;
	redraw();
}

function drawPoints(num){
	let s = "";
	for(let i = 0; i < num; i++) {
		s=s+"⧫"
	}
	return s;
}

function drawTechPanel(){
	let s = "";

	for(let i = 0; i < company.techs.length; i++) {
		let pos_t = "";
		pos_t = pos_t + roleArray[company.techs[i].role];

		s=s+
		"<p class='techID'>Name: " + company.techs[i].name+
		" [" + company.techs[i].morale+" / 10]\n"+
		pos_t+"\n"+
		"<span style='font-size:60%'>" + drawBar(company.techs[i].experiencePerc, 100, 12, "█", "#5df", "#000") + "</span>"+
		" --- Level: " + company.techs[i].level+" <span style='font-size:60%'>("+Math.floor(company.techs[i].experiencePerc) +")</span>\n"+
		"Assembly Prof.: " + company.techs[i].assembProf +" "+drawPoints(company.techs[i].assembProf) +" <span style='font-size:60%'>("+company.techs[i].assembProfGrowth +")</span>\n"+
		"Test Prof.: " + company.techs[i].testProf +" <span style='font-size:60%'>("+company.techs[i].testProfGrowth +")</span>\n"+
		"QT Prof.: " + company.techs[i].qtProf + " <span style='font-size:60%'>("+company.techs[i].qtProfGrowth +")</span>\n"+
		"Admin Prof.: " + company.techs[i].adminProf + " <span style='font-size:60%'>("+company.techs[i].adminProfGrowth +")</span>\n"+
		"Wage: " + company.techs[i].wage +"$/hr\n\n"+
		

		"<button onclick='fireTech(" + i + ")'>Fire</button>"+
		"<button onclick='giveTechRaise(" + i + ")'>Give raise</button>\n";
		if(! company.techs[i].isQT)
			s=s+"<button onclick='promoteQT("+ i +")'>Promote to QT</button>";
		if(! company.techs[i].isTest)
			s=s+"<button onclick='promoteTest("+ i +")'>Promote to Test</button>";
		s=s+
		"\nAssign to Bay: " + (company.techs[i].assignedTo+1) + "\n";
		for(let ii = 0; ii < company.tools.length;ii++) {
			let ex = " class='assignButton' "
			if(company.techs[i].assignedTo==ii) {
				ex = " class='assignButtonSEL' "
			}
			s=s+"<button" +ex+" onclick='assignTech(" + i + ", " + ii+ ")'>" + (ii+1) + "</button>";
		}
		s=s+"</p>";

	}

	document.getElementById("techs").innerHTML = s;
}

function assignTech(tech_i, bay_i) {
	/*
	if(company.bays[bay_i][1].length <3) {	
		unassignTech(tech_i, company.techs[tech_i].assignedTo);
		company.techs[tech_i].assignedTo = tool_i;
		
		if(tool_i > -1)
			company.tools[tool_i].techsOnTool.push(tech_i);
		redraw();
	}else
		addAct("!Can't assign another Tech on this tool!");
	*/
}

function unassignTech(tech_i, tool_i) {
	/*
	if(tool_i > -1) {
		for(let i = 0; i < company.tools[tool_i].techsOnTool.length; i++) {
			if(company.tools[tool_i].techsOnTool[i] == tech_i) {
				pop_i(company.tools[tool_i].techsOnTool,i);
				company.techs[tech_i].assignedTo = -1;
			}
		}
	}
	*/
}
function unassignAllTechsFromTool(tool_i) {
	/*
	for(let i = 0; i < company.tools[tool_i].techsOnTool.length; i++) {
		
		company.techs[company.tools[tool_i].techsOnTool[i] ].assignedTo = -1;
	}*/
}


function fireTech(index) {
	//company.techs.copyWithin(index,index+1,company.techs.length);
	//company.techs.pop();

	pop_i(company.techs, index);
	for(let i = 0; i < company.techs.length; i++) {
		company.techs[i].morale--;
	}
	redraw();

}
function giveTechRaise(index) {
	company.techs[index].wage++;
	company.techs[index].morale++;
	
	redraw();

}



function addAct(s) {
	company.recentActions.push(s);
	if(company.recentActions.length > 20)
		company.recentActions.shift();
}

function newShift() {

	company.time=0;
	company.shift++;
	payShift();
	if(company.shift%14==0) doPayroll();
}


function payShift() {
	for(let i = 0; i <  company.techs.length; i++) {
		company.payroll += company.techs[i].wage * 12
	}
}

function doPayroll(){
	let m = company.payroll;
	company.money -= company.payroll;
	addAct("Payroll, minus " + m);
	company.payroll = 0;
}



function mousetest(event) {
	let w = document.get
	let p = document.getElementById("bob");
	p.style.right = window.innerWidth-event.clientX-(p.offsetWidth/2) + "px";
	p.style.top = (event.clientY+30) + "px";

}


</script>

</head>


<body id="body" onmousemove="mousetest(event)" onload="init()">
	<canvas id="bob" class="techcanvas" style="position: absolute;">Test</canvas>
	<h1>Supe Simulator</h1>
	<p class="recentActions1" onclick="toggleSpeed()">debug SuperSpeed</p>
	<p id="debug_console">load</p>
	<table>
		<tr>
			<td style="width: 85%;">
				<div style="width: 1000px;overflow-x: scroll;">
				<table id="newGUI"></table>
				</div>
			</td>
			<td style="width: 50px;">
				<canvas class="gamecanvas"></canvas>
			</td>
			<td rowspan="2" style="width: 300px;">
				<p class="gametable" style="font-size: 1.1em;line-height: 1.3;white-space: pre-line;" id="gui"></p>
				<p class="gametable"  id="gui2"></p>
				<div class="recentActions1" style="overflow-y: scroll;height: 250px;white-space: pre-line;" id="recentActions"></div>
			</td>
		</tr>

		<tr>
			<td colspan="2" style="width: 85%;">
				<div style="background-color: azure;overflow-x: scroll;" id="techs">Test</div>
			</td>
		</tr>
	</table>
</body>

<!-- 
init()
progressTime()

 -->